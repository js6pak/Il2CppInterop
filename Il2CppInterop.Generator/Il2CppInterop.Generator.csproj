<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>net7.0;net472</TargetFrameworks>

    <Description>Library for generating assemblies and metadata for calling Il2Cpp functions from .NET</Description>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="AsmResolver.DotNet" Version="5.3.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\Il2CppInterop.Common\Il2CppInterop.Common.csproj" />
  </ItemGroup>

  <!-- Lightweight alternative to ThisAssembly.Constants -->
  <Target Name="AddConstantsAssemblyInfo" BeforeTargets="BeforeCompile;CoreCompile" DependsOnTargets="GetAssemblyVersion">
    <PropertyGroup>
      <GeneratedAssemblyConstantsFile>$(IntermediateOutputPath)$(MSBuildProjectName).AssemblyConstants.cs</GeneratedAssemblyConstantsFile>

      <!-- language=c# -->
      <_Lines><![CDATA[$([MSBuild]::Escape('
// <auto-generated/>
namespace $(RootNamespace);

internal partial class Constants
{
  public static Version Il2CppInteropRuntimeVersion { get; } = Version.Parse("$(AssemblyVersion)");
  public static Version Il2CppInteropBindingsVersion { get; } = Version.Parse("$(Il2CppInteropBindingsVersion)");
}
'))]]></_Lines>
    </PropertyGroup>

    <WriteLinesToFile File="$(GeneratedAssemblyConstantsFile)" Overwrite="true" WriteOnlyWhenDifferent="true" Lines="$(_Lines)" />

    <ItemGroup>
      <Compile Include="$(GeneratedAssemblyConstantsFile)" />
    </ItemGroup>
  </Target>
</Project>
